<div class="ribbon mdl-cell mdl-cell--12-col"></div>
<div class="wrapper">
  <div class="mdl-grid">
    <!--Page Header-->
      <div data-ui-field="page_header" class="mdl-color-text--white mdl-cell mdl-cell--12-col header">
          <button id="back" class="mdl-button mdl-button--colored mdl-js-button" onclick="select_page('home')"><i class="material-icons">arrow_back</i></button>
          <h4 data-ui-field="title">Create Inventory</h4>
      </div>
    <!-- Main Content-->
    <div class="container mdl-grid">
      
      <div class="content mdl-color--white mdl-shadow--4dp mdl-color-text--grey-800 mdl-cell mdl-cell--8-col mdl-cell--3-col-phone">
          <div class="mdl-cell mdl-cell--12-col centered">
            <h3 data-ui-field="title">Add new Item</h3>
            <form action="#">
              <h5 data-ui-field="subtitle">Product Name:</h5>
              <div class="mdl-textfield mdl-js-textfield product_textfield">
                <input class="mdl-textfield__input" type="text" id="prodname">
                <label class="mdl-textfield__label" for="prodname">Product Name</label>
              </div>
            </form>
          </div>
          <div class="mdl-cell mdl-cell--12-col centered">
            <div class="mdl-cell mdl-cell--12-col row">
              <button data-ui-field="button" id="camera--trigger"  class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
                <img src="/images/barcode-scan.png">
              </button>
            </div>
              <div class="mdl-color-text--deep-orange-A200 row">
                  <i class="material-icons-outlined deeporangeA200">info</i>
                  <p class="deeporangeA200">Scan barcode and we'll retrieve data and product image from Open Food Facts</p>
              </div>
          </div>
          
          <!-- <video id="preview"></video>
              Camera
                    <section id="camera">       
                      Camera sensor
                        <canvas id="camera--sensor"></canvas>        
                      Camera view
                        <video id="camera--view" autoplay playsinline></video>        
                      Camera output
                        <img src="//:0" alt="" id="camera--output">        
                        
                    </section>
                  -->

          <div class="mdl-cell mdl-cell--12-col centered">        
              <h5 data-ui-field="subtitle">OR</h5>
              <form action="#">
                <div data-ui-field="numerical-input" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                  <input class="mdl-textfield__input" type="text" maxlength="13" pattern="[0-9]*" inputmode="numeric" oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*?)\..*/g, '$1');"  id="barcodenum" />
                  <label class="mdl-textfield__label" for="barcodenum">Input barcode</label>
                  <!-- <span class="mdl-textfield__error">Input is not a number!</span> -->
                </div>
              </form>
              <button data-ui-field="button" class="mdl-button mdl-js-button mdl-button--primary" onclick="select_page('details')">
                <i class="material-icons-outlined next">navigate_next</i>
              </button> 
          </div>
        </div>
      </div>

    </div>
  </div>
</div>


<script src="/js/instascan.min.js"></script>
<script type="text/javascript">
  let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
  scanner.addListener('scan', function (content) {
    console.log(content);
  });
  Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
      scanner.start(cameras[0]);
    } else {
      console.error('No cameras found.');
    }
  }).catch(function (e) {
    console.error(e);
  });


  // Camera //
  // Set constraints for the video stream
  var constraints = { video: { facingMode: "user" }, audio: false };// Define constants
  const cameraView = document.querySelector("#camera--view"),
      cameraOutput = document.querySelector("#camera--output"),
      cameraSensor = document.querySelector("#camera--sensor"),
      cameraTrigger = document.querySelector("#camera--trigger")// Access the device camera and stream to cameraView
  function cameraStart() {
      navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(stream) {
          track = stream.getTracks()[0];
          cameraView.srcObject = stream;
      })
      .catch(function(error) {
          console.error("Oops. Something is broken.", error);
      });
  }
// Take a picture when cameraTrigger is tapped
  cameraTrigger.onclick = function() {
      cameraSensor.width = cameraView.videoWidth;
      cameraSensor.height = cameraView.videoHeight;
      cameraSensor.getContext("2d").drawImage(cameraView, 0, 0);
      cameraOutput.src = cameraSensor.toDataURL("image/webp");
      cameraOutput.classList.add("taken");
  };
// Start the video stream when the window loads
  window.addEventListener("load", cameraStart, false);
</script>

