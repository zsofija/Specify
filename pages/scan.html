<div class="demo-ribbon"></div>
<main class="demo-main mdl-layout__content">
  <div class="demo-container mdl-grid">
    <div class="mdl-cell mdl-cell--3-col mdl-cell--hide-tablet mdl-cell--hide-phone"></div>
    <div class="demo-content mdl-color--white mdl-shadow--4dp content mdl-color-text--grey-800 mdl-cell mdl-cell--8-col mdl-cell--3-col-phone">

        <h3 data-ui-field="title">Scan Inventory</h3>
        <h5 data-ui-field="subtitle">Scan barcode</h5>
        <span class="iconify" data-icon="mdi:barcode-scan" data-inline="false"></span>
        <video id="preview"></video>
             <!-- Camera -->
                  <section id="camera">       
                    <!-- Camera sensor -->
                      <canvas id="camera--sensor"></canvas>        
                    <!-- Camera view -->
                      <video id="camera--view" autoplay playsinline></video>        
                    <!-- Camera output -->
                      <img src="//:0" alt="" id="camera--output">        
                       
                  </section>


        <h5 data-ui-field="subtitle">OR</h5>
        <form action="#">
          <div data-ui-field="numerical-input" class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
            <input class="mdl-textfield__input" type="text" pattern="-?[0-9]*(\.[0-9]+)?" id="sample4">
            <label class="mdl-textfield__label" for="sample4">Input barcode</label>
            <span class="mdl-textfield__error">Input is not a number!</span>
          </div>
        </form>
        <button data-ui-field="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" id="camera--trigger">
           Scan item
        </button>

    </div>
    
</div>
<script src="/js/instascan.min.js"></script>
<script type="text/javascript">
  let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
  scanner.addListener('scan', function (content) {
    console.log(content);
  });
  Instascan.Camera.getCameras().then(function (cameras) {
    if (cameras.length > 0) {
      scanner.start(cameras[0]);
    } else {
      console.error('No cameras found.');
    }
  }).catch(function (e) {
    console.error(e);
  });


  // Camera //
  // Set constraints for the video stream
  var constraints = { video: { facingMode: "user" }, audio: false };// Define constants
  const cameraView = document.querySelector("#camera--view"),
      cameraOutput = document.querySelector("#camera--output"),
      cameraSensor = document.querySelector("#camera--sensor"),
      cameraTrigger = document.querySelector("#camera--trigger")// Access the device camera and stream to cameraView
  function cameraStart() {
      navigator.mediaDevices
          .getUserMedia(constraints)
          .then(function(stream) {
          track = stream.getTracks()[0];
          cameraView.srcObject = stream;
      })
      .catch(function(error) {
          console.error("Oops. Something is broken.", error);
      });
  }
// Take a picture when cameraTrigger is tapped
  cameraTrigger.onclick = function() {
      cameraSensor.width = cameraView.videoWidth;
      cameraSensor.height = cameraView.videoHeight;
      cameraSensor.getContext("2d").drawImage(cameraView, 0, 0);
      cameraOutput.src = cameraSensor.toDataURL("image/webp");
      cameraOutput.classList.add("taken");
  };
// Start the video stream when the window loads
  window.addEventListener("load", cameraStart, false);
</script>
</main>
